echo aG9va2Z1bmN0aW9uKGdldG5hbWVjYWxsbWV0aG9kLCBmdW5jdGlvbigpCiAgcmV0dXJuCmVuZCkKZm9yIGksIHYgaW4gcGFpcnMoe3JlcXVlc3QsIGxvYWRzdHJpbmcsIGJhc2U2NC5kZWNvZGV9KSBkbwogIGlmIGlzZnVuY3Rpb25ob29rZWQodikgb3Igbm90IGlzZnVuY3Rpb25ob29rZWQoZ2V0bmFtZWNhbGxtZXRob2QpIHRoZW4KICAgIHJldHVybgogIGVuZAplbmQKbG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikKbG9jYWwgUGxyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTFAgPSBQbHIuTG9jYWxQbGF5ZXIKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgQ2xpZW50TW9kdWxlID0gcmVxdWlyZShMUDpXYWl0Rm9yQ2hpbGQoIlBsYXllclNjcmlwdHMiKTpXYWl0Rm9yQ2hpbGQoIkNsaWVudCIpKQpsb2NhbCBFYXRSZW1vdGUgPSBDbGllbnRNb2R1bGUgYW5kIENsaWVudE1vZHVsZS5FdmVudHMgYW5kIENsaWVudE1vZHVsZS5FdmVudHMuUmVxdWVzdENvbnN1bWVJdGVtCmdldGdlbnYoKS5XUyA9IExQLkNoYXJhY3Rlci5IdW1hbm9pZC5XYWxrU3BlZWQKcmV0dXJuKGZ1bmN0aW9uKCkKICBsb2NhbCBmdW5jdGlvbiBHZXRBc3NldCh2KQogICAgbG9jYWwgYiA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvJwogICAgcmV0dXJuIEh0dHBTZXJ2aWNlOkpTT05EZWNvZGUocmVxdWVzdCh7CiAgICAgIFVybCA9IHYsCiAgICAgIEhlYWRlcnMgPSB7CiAgICAgICAgQXV0aG9yaXphdGlvbiA9ICJCZWFyZXIgZ2l0aHViX3BhdF8xMUJPNFhUVEkwVndPSGZJTFRPWVlaX0lBaUxXN0ZMUTJDOHB3Z0VHcldmR1pwUTh6Uzl5eVgzbjFJMVNVMnNIMnRaRVhHTlhKUXZFSzV6NlBEIgogICAgICB9CiAgICB9KS5Cb2R5KS5jb250ZW50OmdzdWIoJ1teJy4uYi4uJz1dJywgJycpOmdzdWIoJy4nLCBmdW5jdGlvbih4KQogICAgICBpZiAoeCA9PSAnPScpIHRoZW4gcmV0dXJuICcnIGVuZAogICAgICBsb2NhbCByLGY9JycsKGI6ZmluZCh4KS0xKQogICAgICBmb3IgaT02LDEsLTEgZG8gcj1yLi4oZiUyXmktZiUyXihpLTEpPjAgYW5kICcxJyBvciAnMCcpIGVuZAogICAgICByZXR1cm4gcjsKICAgIGVuZCk6Z3N1YignJWQlZCVkPyVkPyVkPyVkPyVkPyVkPycsIGZ1bmN0aW9uKHgpCiAgICAgIGlmICgjeCB+PSA4KSB0aGVuIHJldHVybiAnJyBlbmQKICAgICAgbG9jYWwgYz0wCiAgICAgIGZvciBpPTEsOCBkbyBjPWMrKHg6c3ViKGksaSk9PScxJyBhbmQgMl4oOC1pKSBvciAwKSBlbmQKICAgICAgcmV0dXJuIHN0cmluZy5jaGFyKGMpCiAgICBlbmQpCiAgZW5kCiAgaWYgSHR0cFNlcnZpY2U6SlNPTkRlY29kZShHZXRBc3NldCgiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy9M6ISa5pysLVNjcmlwdC9M6ISa5pysL2NvbnRlbnRzL0lEL2luZGV4Lmpzb24/cmVmPW1haW4iKSlbTFAuTmFtZV0gPT0gTFAuVXNlcklkIHRoZW4KICAgIGxvY2FsIFdpbmRVSSA9IGxvYWRzdHJpbmcoR2V0QXNzZXQoImh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvTOiEmuacrC1TY3JpcHQvTOiEmuacrC9jb250ZW50cy9M6ISa5pysX1VJL0zohJrmnKxfV2luZFVJXzUuMCIpKSgpCiAgICBsb2NhbCBM6ISa5pysID0gewogICAgICBbIuadgOaIruWFieeOryJdID0gZmFsc2UsCiAgICAgIFsi6Ieq5Yqo56CN5qCRIl0gPSBmYWxzZSwKICAgICAgWyLoh6rliqjov5vpo58iXSA9IGZhbHNlLAogICAgICBbIumAj+inhuWtqeWtkCJdID0gZmFsc2UsCiAgICAgIFsi6YCP6KeG5a6d566xIl0gPSBmYWxzZQogICAgfQogICAgbG9jYWwgQkwgPSB7fQogICAgbG9jYWwgQ2xpZW50TW9kdWxlID0gcmVxdWlyZShMUDpXYWl0Rm9yQ2hpbGQoIlBsYXllclNjcmlwdHMiKTpXYWl0Rm9yQ2hpbGQoIkNsaWVudCIpKQogICAgbG9jYWwgRWF0UmVtb3RlID0gQ2xpZW50TW9kdWxlIGFuZCBDbGllbnRNb2R1bGUuRXZlbnRzIGFuZCBDbGllbnRNb2R1bGUuRXZlbnRzLlJlcXVlc3RDb25zdW1lSXRlbQogICAgbG9jYWwgZnVuY3Rpb24gQWRkRVNQKHBhcnQsIHR4dDEsIHR4dDIsIGVuYWJsZWQpCiAgICAgIGxvY2FsIEJHID0gcGFydDpGaW5kRmlyc3RDaGlsZCgiQmlsbGJvYXJkR3VpIikKICAgICAgaWYgbm90IEJHIHRoZW4KICAgICAgICBsb2NhbCBiZyA9IEluc3RhbmNlLm5ldygiQmlsbGJvYXJkR3VpIikKICAgICAgICBiZy5BZG9ybmVlID0gcGFydAogICAgICAgIGJnLlBhcmVudCA9IHBhcnQKICAgICAgICBiZy5TaXplID0gVURpbTIubmV3KDAsIDEwMCwgMCwgMTAwKQogICAgICAgIGJnLlN0dWRzT2Zmc2V0ID0gVmVjdG9yMy5uZXcoMCwgMywgMCkKICAgICAgICBiZy5BbHdheXNPblRvcCA9IHRydWUKICAgICAgICBsb2NhbCBUTCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIiwgYmcpCiAgICAgICAgVEwuVGV4dCA9IHR4dDEgLi4gIlxuIiAuLiB0eHQyIC4uICJtIgogICAgICAgIFRMLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMCwgNDApCiAgICAgICAgVEwuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMCwgMCkKICAgICAgICBUTC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgIFRMLlRleHRDb2xvcjMgPSBDb2xvcjMubmV3KDEsIDEsIDEpCiAgICAgICAgVEwuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDAuMwogICAgICAgIFRMLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZAogICAgICAgIFRMLlRleHRTaXplID0gMTQKICAgICAgICBsb2NhbCBJbWcgPSBJbnN0YW5jZS5uZXcoIkltYWdlTGFiZWwiLCBiZykKICAgICAgICBJbWcuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMjAsIDAsIDQwKQogICAgICAgIEltZy5TaXplID0gVURpbTIubmV3KDAsIDYwLCAwLCA2MCkKICAgICAgICBJbWcuSW1hZ2UgPSBwYXJ0Lk5hbWU6bWF0Y2goIkNoZXN0IikgYW5kICJyYnhhc3NldGlkOi8vMTg2NjA1NjMxMTYiIG9yICIiCiAgICAgICAgSW1nLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgIGVsc2UKICAgICAgICBsb2NhbCBiZyA9IEJHCiAgICAgICAgYmcuVGV4dExhYmVsLlRleHQgPSB0eHQxIC4uICJcbiIgLi4gdHh0MiAuLiAibSIKICAgICAgICBiZy5FbmFibGVkID0gZW5hYmxlZAogICAgICBlbmQKICAgIGVuZAogICAgbG9jYWwgZnVuY3Rpb24gQ29sbGVjdCh0aGluZykKICAgICAgZm9yIF8sIG9iaiBpbiBwYWlycyh3b3Jrc3BhY2U6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICBpZiBvYmo6SXNBKCJNb2RlbCIpIGFuZCBvYmouTmFtZSA9PSB0aGluZyB0aGVuCiAgICAgICAgICBsb2NhbCBwYXJ0ID0gb2JqLlByaW1hcnlQYXJ0IG9yIG9iajpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJCYXNlUGFydCIpCiAgICAgICAgICBpZiBwYXJ0IHRoZW4KICAgICAgICAgICAgcGFydC5DRnJhbWUgPSBMUC5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDIsIDApCiAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgZW5kCiAgICBlbmQKICAgIGxvY2FsIGZ1bmN0aW9uIHRyeUVhdEZvb2QoZm9vZCkKICAgICAgaWYgbm90IEVhdFJlbW90ZSB0aGVuIHdhcm4oIvCfmqsgTm8gRWF0UmVtb3RlIikgcmV0dXJuIGVuZAogICAgICBpZiBub3QgUmVwbGljYXRlZFN0b3JhZ2U6RmluZEZpcnN0Q2hpbGQoIlRlbXBTdG9yYWdlIikgdGhlbiB3YXJuKCLwn5qrIE5vIFRlbXBTdG9yYWdlIikgcmV0dXJuIGVuZAogICAgICBXaW5kVUk6Tm90aWZ5KHtUaXRsZSA9ICJM6ISa5pysIiwgQ29udGVudCA9ICLinqHvuI8g5q2j5Zyo5bCd6K+V5ZCD5LiLIiAuLiBmb29kLk5hbWUsIER1cmF0aW9uID0gNX0pCiAgICAgIGZvb2QuUGFyZW50ID0gUmVwbGljYXRlZFN0b3JhZ2UuVGVtcFN0b3JhZ2UKICAgICAgbG9jYWwgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHJldHVybiBFYXRSZW1vdGU6SW52b2tlU2VydmVyKGZvb2QpCiAgICAgIGVuZCkKICAgICAgaWYgc3VjY2VzcyBhbmQgcmVzdWx0IGFuZCByZXN1bHQuU3VjY2VzcyB0aGVuCiAgICAgICAgV2luZFVJOk5vdGlmeSh7VGl0bGUgPSAiTOiEmuacrCIsIENvbnRlbnQgPSAi4pyF5oiQ5Yqf5ZCD5LiLICIgLi4gZm9vZC5OYW1lLCBEdXJhdGlvbiA9IDV9KQogICAgICAgIHJldHVybgogICAgICAgZWxzZQogICAgICAgIFdpbmRVSTpOb3RpZnkoe1RpdGxlID0gIkzohJrmnKwiLCBDb250ZW50ID0gIuKdjO+4j+i/m+mjn+Wksei0pSIsIER1cmF0aW9uID0gNX0pCiAgICAgICAgcmV0dXJuCiAgICAgIGVuZAogICAgZW5kCiAgICBsb2NhbCBQbGF5ZXJMaXN0ID0ge30KICAgIGZvciBhLCBiIGluIG5leHQsIFBscjpHZXRQbGF5ZXJzKCkgZG8KICAgICAgdGFibGUuaW5zZXJ0KFBsYXllckxpc3QsIGIuTmFtZSkKICAgIGVuZAogICAgV2luZFVJOk5vdGlmeSh7VGl0bGUgPSAiIEzohJrmnKwiLCBDb250ZW50ID0gIuKcheWQr+WKqOaIkOWKn+KchSIsIER1cmF0aW9uID0gNX0pCiAgICAgICAgICAgIGxvY2FsIFdpbmRvdyA9IFdpbmRVSTpDcmVhdGVXaW5kb3coewogICAgICAgICAgICBUaXRsZSA9ICIgTOiEmuacrCAvIOajruael+S4reeahDk55aScIiwKICAgICAgICAgICAgSWNvbiA9ICJyYnhhc3NldGlkOi8vNDQ4MzM2Mjc0OCIsCiAgICAgICAgICAgIEljb25UaGVtZWQgPSB0cnVlLAogICAgICAgICAgICBBdXRob3IgPSAiIEzohJrmnKwiLAogICAgICAgICAgICBGb2xkZXIgPSAiQ2xvdWRIdWIiLAogICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCgzMDAsIDI3MCksCiAgICAgICAgICAgIFRyYW5zcGFyZW50ID0gdHJ1ZSwKICAgICAgICAgICAgVGhlbWUgPSAiRGFyayIsCiAgICAgICAgICAgIFVzZXIgPSB7RW5hYmxlZCA9IHRydWUsIENhbGxiYWNrID0gZnVuY3Rpb24oKSBwcmludCgiY2xpY2tlZCIpIGVuZCwgQW5vbnltb3VzID0gZmFsc2V9LAogICAgICAgICAgICBTaWRlQmFyV2lkdGggPSAyMDAsCiAgICAgICAgICAgIFNjcm9sbEJhckVuYWJsZWQgPSB0cnVlLAogICAgICAgIH0pCgogICAgICAgIFdpbmRvdzpFZGl0T3BlbkJ1dHRvbih7CiAgICAgICAgICAgIFRpdGxlID0gIuaJk+W8gOiEmuacrCIsCiAgICAgICAgICAgIEljb24gPSAibW9uaXRvciIsCiAgICAgICAgICAgIENvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsMTYpLAogICAgICAgICAgICBTdHJva2VUaGlja25lc3MgPSA0LAogICAgICAgICAgICBDb2xvciA9IENvbG9yU2VxdWVuY2UubmV3KHsKICAgICAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgQ29sb3IzLmZyb21IZXgoIkZGMDAwMCIpKSwKICAgICAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMC4xNiwgQ29sb3IzLmZyb21IZXgoIkZGN0YwMCIpKSwKICAgICAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMC4zMywgQ29sb3IzLmZyb21IZXgoIkZGRkYwMCIpKSwKICAgICAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMC41LCBDb2xvcjMuZnJvbUhleCgiMDBGRjAwIikpLAogICAgICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLjY2LCBDb2xvcjMuZnJvbUhleCgiMDAwMEZGIikpLAogICAgICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLjgzLCBDb2xvcjMuZnJvbUhleCgiNEIwMDgyIikpLAogICAgICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCBDb2xvcjMuZnJvbUhleCgiOTQwMEQzIikpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBEcmFnZ2FibGUgPSB0cnVlLAogICAgICAgIH0pCgogICAgICAgIGxvY2FsIE1haW5TZWN0aW9uID0gV2luZG93OlNlY3Rpb24oe1RpdGxlID0gIuS4u+imgSIsIE9wZW5lZCA9IHRydWV9KQogICAgICAgIAogICAgICAgIGxvY2FsIGZ1bmN0aW9uIEFkZFRhYihhLCBiKQogICAgICAgICAgICByZXR1cm4gTWFpblNlY3Rpb246VGFiKHtUaXRsZSA9IGEsIEljb24gPSBifSkKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBCdG4oYSwgYiwgYykKICAgICAgICAgICAgcmV0dXJuIGE6QnV0dG9uKHtUaXRsZSA9IGIsIENhbGxiYWNrID0gY30pCiAgICAgICAgZW5kCiAgICAgICAgZnVuY3Rpb24gVGcoYSwgYiwgYywgZCkKICAgICAgICAgICByZXR1cm4gYTpUb2dnbGUoe1RpdGxlID0gYiwgSW1hZ2UgPSAiYmlyZCIsIFZhbHVlID0gYywgQ2FsbGJhY2sgPSBkfSkKICAgICAgICBlbmQKICAgIGZ1bmN0aW9uIFNsZChhLCBiLCBjLCBkLCBlLCBmKQogICAgICAgICAgIHJldHVybiBhOlNsaWRlcih7VGl0bGUgPSBiLCBTdGVwID0gMSwgVmFsdWUgPSB7TWluID0gYywgTWF4ID0gZCwgRGVmYXVsdCA9IGV9LCBDYWxsYmFjayA9IGZ9KQogICAgICAgIGVuZAogIAogICAgQSA9IEFkZFRhYigi5Li76KaBIiwicmJ4YXNzZXRpZDovLzQ0ODMzNjQyMzciKQogICAgQiA9IEFkZFRhYigi5pS26ZuGIiwicmJ4YXNzZXRpZDovLzQ0MDA3MDE4MjgiKQogICAgQyA9IEFkZFRhYigi6YCP6KeGIiwicmJ4YXNzZXRpZDovLzM2MTAyNTQyMjkiKQogICAgRCA9IEFkZFRhYigi5Lyg6YCBIiwicmJ4YXNzZXRpZDovLzM5NDQ2OTA2NjciKQogICAgRSA9IEFkZFRhYigi546p5a62IiwicmJ4YXNzZXRpZDovLzQzMzU0ODA4OTYiKQogICAgCiAgICBXaW5kb3c6U2VsZWN0VGFiKDEpCgogICAgVGcoQSwgIuadgOaIruWFieeOryIsIGZhbHNlLCBmdW5jdGlvbih0KQogICAgICAgTOiEmuacrFsi5p2A5oiu5YWJ546vIl0gPSB0CiAgICBlbmQpCiAgICBUZyhBLCAi6Ieq5Yqo56CN5qCRIiwgZmFsc2UsIGZ1bmN0aW9uKHQpCiAgICAgIEzohJrmnKxbIuiHquWKqOegjeagkSJdID0gdAogICAgZW5kKQogICAgVGcoQSwgIuiHquWKqOi/m+mjnyIsIGZhbHNlLCBmdW5jdGlvbih0KQogICAgICBM6ISa5pysWyLoh6rliqjov5vpo58iXSA9IHQKICAgIGVuZCkKICAgIFRnKEEsICLnnqzpl7TkupLliqgiLCBmYWxzZSwgZnVuY3Rpb24odCkKICAgICAgaWYgdCB0aGVuCiAgICAgICAgaWYgbm90IGNvbm5lY3Rpb24gdGhlbgogICAgICAgICAgY29ubmVjdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiUHJveGltaXR5UHJvbXB0U2VydmljZSIpLlByb21wdEJ1dHRvbkhvbGRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKHByb21wdCkKICAgICAgICAgICAgcHJvbXB0LkhvbGREdXJhdGlvbiA9IDAKICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgICAgIGVsc2UKICAgICAgICBpZiBjb25uZWN0aW9uIHRoZW4KICAgICAgICAgIGNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgZW5kCiAgICAgIGVuZAogICAgZW5kKQoKICAgIEI6UGFyYWdyYXBoKHsKICAgICAgVGl0bGUgPSAi5pS26ZuG5Yqf6IO94oaTIiwKICAgICAgRGVzYyA9ICLmiorlnLDlm77ph4zkvaDmg7PopoHnmoTnianlk4HkvKDpgIHliLDoh6rlt7HnmoTkvY3nva4iLAogICAgICBDb2xvciA9ICJHcmV5IgogICAgfSkKICAgIGxvY2FsIEJTMSA9IEI6U2VjdGlvbih7VGl0bGUgPSAi4pqU77iP5q2m5Zmo6KOF5aSHIiwgVGV4dFhBbGlnbm1lbnQgPSAiTGVmdCIsIFRleHRTaXplID0gMTd9KQogICAgQnRuKEIsICLlt6bova4iLCBmdW5jdGlvbigpIENvbGxlY3QoIlJldm9sdmVyIikgZW5kKQogICAgQnRuKEIsICLmraXmnqoiLCBmdW5jdGlvbigpIENvbGxlY3QoIlJpZmxlIikgZW5kKQogICAgQnRuKEIsICLlt6bova7lrZDlvLkiLCBmdW5jdGlvbigpIENvbGxlY3QoIlJldm9sdmVyIEFtbW8iKSBlbmQpCiAgICBCdG4oQiwgIuatpeaequWtkOW8uSIsIGZ1bmN0aW9uKCkgQ29sbGVjdCgiUmlmbGUgQW1tbyIpIGVuZCkKICAgIEJ0bihCLCAi55qu6Z2pIiwgZnVuY3Rpb24oKSBDb2xsZWN0KCJMZWF0aGVyIEJvZHkiKSBlbmQpCiAgICBCdG4oQiwgIumTgeeUsiIsIGZ1bmN0aW9uKCkgQ29sbGVjdCgiSXJvbiBCb2R5IikgZW5kKQogICAgQnRuKEIsICLojYbmo5jpk6DnlLIiLCBmdW5jdGlvbigpIENvbGxlY3QoIlRob3JuIEJvZHkiKSBlbmQpCiAgICBsb2NhbCBCUzIgPSBCOlNlY3Rpb24oe1RpdGxlID0gIvCflKjliLbkvZznianlk4EiLCBUZXh0WEFsaWdubWVudCA9ICJMZWZ0IiwgVGV4dFNpemUgPSAxN30pCiAgICBCdG4oQiwgIuieuuagkyIsIGZ1bmN0aW9uKCkgQ29sbGVjdCgiQm9sdCIpIGVuZCkKICAgIEJ0bihCLCAi6YeR5bGe6JaE5p2/IiwgZnVuY3Rpb24oKSBDb2xsZWN0KCJTaGVldCBNZXRhbCIpIGVuZCkKICAgIEJ0bihCLCAi5pen5pS26Z+z5py6IiwgZnVuY3Rpb24oKSBDb2xsZWN0KCJPbGQgUmFkaW8iKSBlbmQpCiAgICBCdG4oQiwgIuaNn+Wdj+eahOeUteaJhyIsIGZ1bmN0aW9uKCkgQ29sbGVjdCgiQnJva2VuIEZhbiIpIGVuZCkKICAgIEJ0bihCLCAi5o2f5Z2P55qE5b6u5rOi54KJIiwgZnVuY3Rpb24oKSBDb2xsZWN0KCJCcm9rZW4gTWljcm93YXZlIikgZW5kKQogICAgbG9jYWwgQlMzID0gQjpTZWN0aW9uKHtUaXRsZSA9ICLwn5ui77iP54eD5paZ57G75Z6LIiwgVGV4dFhBbGlnbm1lbnQgPSAiTGVmdCIsIFRleHRTaXplID0gMTd9KQogICAgQnRuKEIsICLmnKjlpLQiLCBmdW5jdGlvbigpIENvbGxlY3QoIkxvZyIpIGVuZCkKICAgIEJ0bihCLCAi5qSF5a2QIiwgZnVuY3Rpb24oKSBDb2xsZWN0KCJDaGFpciIpIGVuZCkKICAgIEJ0bihCLCAi54eD5paZ572QIiwgZnVuY3Rpb24oKSBDb2xsZWN0KCJGdWVsIENhbmlzdGVyIikgZW5kKQogICAgQnRuKEIsICLmsrnmobYiLCBmdW5jdGlvbigpIENvbGxlY3QoIk9pbCBCYXJyZWwiKSBlbmQpCiAgICBCdG4oQiwgIueUn+eJqeeHg+aWmSIsIGZ1bmN0aW9uKCkgQ29sbGVjdCgiQmlvZnVlbCIpIGVuZCkKICAgIEJ0bihCLCAi54WkIiwgZnVuY3Rpb24oKSBDb2xsZWN0KCJDb2FsIikgZW5kKQogICAgbG9jYWwgQlM0ID0gQjpTZWN0aW9uKHtUaXRsZSA9ICLwn6Ws6aOf54mp57G75Z6LIiwgVGV4dFhBbGlnbm1lbnQgPSAiTGVmdCIsIFRleHRTaXplID0gMTd9KQogICAgQnRuKEIsICLokJ3ljZwiLCBmdW5jdGlvbigpIENvbGxlY3QoIkNhcnJvdCIpIGVuZCkKICAgIEJ0bihCLCAi5rWG5p6cIiwgZnVuY3Rpb24oKSBDb2xsZWN0KCJCZXJyeSIpIGVuZCkKICAgIEJ0bihCLCAi55Sf6aOfIiwgZnVuY3Rpb24oKSBDb2xsZWN0KCJNb3JzZWwiKSBlbmQpCiAgICBCdG4oQiwgIueUn+eJm+iCiSIsIGZ1bmN0aW9uKCkgQ29sbGVjdCgiU3RlYWsiKSBlbmQpCiAgICBCdG4oQiwgIueGn+mjnyIsIGZ1bmN0aW9uKCkgQ29sbGVjdCgiQ29va2VkIE1vcnNlbCIpIGVuZCkKICAgIEJ0bihCLCAi54af54mb6IKJIiwgZnVuY3Rpb24oKSBDb2xsZWN0KCJDb29rZWQgU3RlYWsiKSBlbmQpCiAgICBsb2NhbCBCUzUgPSBCOlNlY3Rpb24oe1RpdGxlID0gIvCfkonmsrvnlpfnianlk4EiLCBUZXh0WEFsaWdubWVudCA9ICJMZWZ0IiwgVGV4dFNpemUgPSAxN30pCiAgICBCdG4oQiwgIuaApeaVkeWMhSIsIGZ1bmN0aW9uKCkgQ29sbGVjdCgiTWVkS2l0IikgZW5kKQogICAgQnRuKEIsICLnu7fluKYiLCBmdW5jdGlvbigpIENvbGxlY3QoIkJhbmRhZ2UiKSBlbmQpCgogICAgVGcoQywgIui1sOWkseeahOWtqeWtkCIsIGZhbHNlLCBmdW5jdGlvbih0KQogICAgICBM6ISa5pysWyLpgI/op4blranlrZAiXSA9IHQKICAgIGVuZCkKICAgIFRnKEMsICLlrp3nrrEiLCBmYWxzZSwgZnVuY3Rpb24odCkKICAgICAgTOiEmuacrFsi6YCP6KeG5a6d566xIl0gPSB0CiAgICBlbmQpCgogICAgbG9jYWwgQ19QID0gRDpEcm9wZG93bih7VGl0bGUgPSAi5Lyg6YCB546p5a62IiwgVmFsdWVzID0gUGxheWVyTGlzdCwgVmFsdWUgPSAiIiwgQ2FsbGJhY2sgPSBmdW5jdGlvbihkKQogICAgICAgIGlmIFBscltkXSBhbmQgUGxyW2RdLkNoYXJhY3RlciBhbmQgUGxyW2RdLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgIExQLkNoYXJhY3RlcjpQaXZvdFRvKFBscltkXS5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgZW5kCiAgICAgIGVuZH0pCgogICAgU2xkKEUsICLnp7vliqjpgJ/luqYiLCAwLCAyMDAsIExQLkNoYXJhY3Rlci5IdW1hbm9pZC5XYWxrU3BlZWQsIGZ1bmN0aW9uKHMpCiAgICAgIGdldGdlbnYoKS5XUyA9IHMKICAgIGVuZCkKICAgIFNsZChFLCAi5oKs5rWu6auY5bqmIiwgMCwgMjAwLCBMUC5DaGFyYWN0ZXIuSHVtYW5vaWQuSGlwSGVpZ2h0LCBmdW5jdGlvbihzKQogICAgICBMUC5DaGFyYWN0ZXIuSHVtYW5vaWQuSGlwSGVpZ2h0ID0gcwogICAgZW5kKQogICAgVGcoRSwgIueOqeWutuWPkeWFiSIsIGZhbHNlLCBmdW5jdGlvbih0KQogICAgICBpZiB0IHRoZW4KICAgICAgICBsb2NhbCBsaWdodCA9IEluc3RhbmNlLm5ldygiUG9pbnRMaWdodCIsIExQLkNoYXJhY3Rlci5IZWFkKQogICAgICAgIGxpZ2h0Lk5hbWUgPSAibGlnaHQiCiAgICAgICAgbGlnaHQuUmFuZ2UgPSA5OTk5OTk5CiAgICAgICAgbGlnaHQuQnJpZ2h0bmVzcyA9IDE1CiAgICAgICBlbHNlCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKUxQLkNoYXJhY3Rlci5IZWFkLmxpZ2h0OnJlbW92ZSgpZW5kKQogICAgICBlbmQKICAgIGVuZCkKCiAgICBQbHIuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihhKQogICAgICBQbGF5ZXJMaXN0ID0ge30KICAgICAgZm9yIGEsIGIgaW4gbmV4dCwgUGxyOkdldFBsYXllcnMoKSBkbwogICAgICAgIHRhYmxlLmluc2VydChQbGF5ZXJMaXN0LCBiLk5hbWUpCiAgICAgIGVuZAogICAgICB0YXNrLndhaXQoLjEpCiAgICAgIENfUDpSZWZyZXNoKFBsYXllckxpc3QpCiAgICBlbmQpCiAgICBQbHIuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihhKQogICAgICBQbGF5ZXJMaXN0ID0ge30KICAgICAgZm9yIGEsIGIgaW4gbmV4dCwgUGxyOkdldFBsYXllcnMoKSBkbwogICAgICAgIHRhYmxlLmluc2VydChQbGF5ZXJMaXN0LCBiLk5hbWUpCiAgICAgIGVuZAogICAgICB0YXNrLndhaXQoLjEpCiAgICAgIENfUDpSZWZyZXNoKFBsYXllckxpc3QpCiAgICBlbmQpCiAgICBsb2NhbCBsYXN0MSwgbGFzdDIsIGxhc3QzID0gMCwgMCwgMAogICAgZ2FtZVsiUnVuIFNlcnZpY2UiXS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgIGxvY2FsIE5vdyA9IHRpY2soKQogICAgICBpZiBub3QgTFAuQ2hhcmFjdGVyIHRoZW4gcmV0dXJuIGVuZAogICAgICBpZiBub3QgTFAuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbiByZXR1cm4gZW5kCiAgICAgIExQLkNoYXJhY3Rlci5IdW1hbm9pZC5XYWxrU3BlZWQgPSBXUwogICAgICBmb3IgYSwgYiBpbiBuZXh0LCB3b3Jrc3BhY2UuSXRlbXM6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgIGlmIGI6R2V0QXR0cmlidXRlKHRvc3RyaW5nKExQLlVzZXJJZCkgLi4gIk9wZW5lZCIpIHRoZW4KICAgICAgICAgIHRhYmxlLmluc2VydChCTCwgYikKICAgICAgICAgIGlmIGI6RmluZEZpcnN0Q2hpbGQoIkJpbGxib2FyZEd1aSIpIHRoZW4KICAgICAgICAgICAgYi5CaWxsYm9hcmRHdWk6RGVzdHJveSgpCiAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBpZiBiLk5hbWU6bWF0Y2goIkNoZXN0IikgYW5kIGI6SXNBKCJNb2RlbCIpIGFuZCBub3QgdGFibGUuZmluZChCTCwgYikgYW5kIGI6RmluZEZpcnN0Q2hpbGQoIk1haW4iKSB0aGVuCiAgICAgICAgICBBZGRFU1AoYiwgIuWuneeusSIsIHRvc3RyaW5nKG1hdGguZmxvb3IoKExQLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gYi5NYWluLlBvc2l0aW9uKS5NYWduaXR1ZGUpKSwgQWxpZW5YWyLpgI/op4blrp3nrrEiXSkKICAgICAgICBlbmQKICAgICAgZW5kCiAgICAgIGZvciBhLCBiIGluIG5leHQsIHdvcmtzcGFjZS5DaGFyYWN0ZXJzOkdldENoaWxkcmVuKCkgZG8KICAgICAgICBpZiBiOkdldEF0dHJpYnV0ZSgiTG9zdCIpIGFuZCBiOkdldEF0dHJpYnV0ZSgiTG9zdCIpID09IGZhbHNlIHRoZW4KICAgICAgICAgIHRhYmxlLmluc2VydChCTCwgYikKICAgICAgICAgIGlmIGI6RmluZEZpcnN0Q2hpbGQoIkJpbGxib2FyZEd1aSIpIHRoZW4KICAgICAgICAgICAgYi5CaWxsYm9hcmRHdWk6RGVzdHJveSgpCiAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBpZiB0YWJsZS5maW5kKHsiTG9zdCBDaGlsZCIsICJMb3N0IENoaWxkMSIsICJMb3N0IENoaWxkMiIsICJMb3N0IENoaWxkMyIsICJEaW5vIEtpZCIsICJrcmFrZW4ga2lkIiwgIlNxdWlkIGtpZCIsICJLb2FsYSBLaWQiLCAia29hbGEgS2lkIiwgImtvYWxhIn0sIGIuTmFtZSkgYW5kIGI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgbm90IHRhYmxlLmZpbmQoQkwsIGIpIHRoZW4KICAgICAgICAgIEFkZEVTUChiLCAi5a2p5a2QIiwgdG9zdHJpbmcobWF0aC5mbG9vcigoTFAuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBiLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSkpLCBBbGllblhbIumAj+inhuWtqeWtkCJdKQogICAgICAgIGVuZAogICAgICBlbmQKICAgICAgaWYgTFAuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJUb29sSGFuZGxlIikgdGhlbgogICAgICAgIGxvY2FsIHRvb2wgPSBMUC5DaGFyYWN0ZXIuVG9vbEhhbmRsZS5PcmlnaW5hbEl0ZW0uVmFsdWUKICAgICAgICBpZiB0b29sIHRoZW4KICAgICAgICAgIGlmIEzohJrmnKxbIuadgOaIruWFieeOryJdIGFuZCBOb3cgLSBsYXN0MSA+PSAwLjcgdGhlbgogICAgICAgICAgICBsYXN0MSA9IE5vdwogICAgICAgICAgICBpZiBub3QgKHtbIk9sZCBBeGUiXSA9IHRydWUsIFsiR29vZCBBeGUiXSA9IHRydWUsIFsiU3BlYXIiXSA9IHRydWUsIFsiSGF0Y2hldCJdID0gdHJ1ZSwgWyJCb25lIENsdWIiXSA9IHRydWV9KVt0b29sLk5hbWVdIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBmb3IgYSwgYiBpbiBuZXh0LCB3b3Jrc3BhY2UuQ2hhcmFjdGVyczpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgICAgaWYgYjpJc0EoIk1vZGVsIikgYW5kIGI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgYjpGaW5kRmlyc3RDaGlsZCgiSGl0UmVnaXN0ZXJzIikgdGhlbgogICAgICAgICAgICAgICAgaWYgKExQLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gYi5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMTAwIHRoZW4KICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiUmVtb3RlRXZlbnRzIik6V2FpdEZvckNoaWxkKCJUb29sRGFtYWdlT2JqZWN0Iik6SW52b2tlU2VydmVyKGIsIHRvb2wsIHRydWUsIExQLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgIGVuZAogICAgICAgICAgaWYgTOiEmuacrFsi6Ieq5Yqo56CN5qCRIl0gYW5kIE5vdyAtIGxhc3QyID49IDAuNyB0aGVuCiAgICAgICAgICAgIGxhc3QyID0gTm93CiAgICAgICAgICAgIGlmIG5vdCAoe1siT2xkIEF4ZSJdID0gdHJ1ZSwgWyJTdG9uZSBBeGUiXSA9IHRydWUsIFsiSXJvbiBBeGUiXSA9IHRydWV9KVt0b29sLk5hbWVdIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBsb2NhbCBmdW5jdGlvbiBDaG9wVHJlZShQYXRoKQogICAgICAgICAgICAgIGZvciBhLCBiIGluIG5leHQsIFBhdGg6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgdGFzay53YWl0KC4xKQogICAgICAgICAgICAgICAgaWYgYjpJc0EoIk1vZGVsIikgYW5kICh7WyJTbWFsbCBUcmVlIl0gPSB0cnVlLCBbIlRyZWVCaWcxIl0gPSB0cnVlLCBbIlRyZWVCaWcyIl0gPSB0cnVlLCBbIlRyZWVCaWczIl0gPSB0cnVlfSlbYi5OYW1lXSBhbmQgYjpGaW5kRmlyc3RDaGlsZCgiSGl0UmVnaXN0ZXJzIikgdGhlbgogICAgICAgICAgICAgICAgICBsb2NhbCB0cnVuayA9IGI6RmluZEZpcnN0Q2hpbGQoIlRydW5rIikgb3IgYjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIG9yIGIuUHJpbWFyeVBhcnQKICAgICAgICAgICAgICAgICAgaWYgdHJ1bmsgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIChMUC5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIHRydW5rLlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMTAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZUV2ZW50cyIpOldhaXRGb3JDaGlsZCgiVG9vbERhbWFnZU9iamVjdCIpOkludm9rZVNlcnZlcihiLCB0b29sLCB0cnVlLCBMUC5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBDaG9wVHJlZSh3b3Jrc3BhY2UuTWFwLkZvbGlhZ2UpCiAgICAgICAgICAgIENob3BUcmVlKHdvcmtzcGFjZS5NYXAuTGFuZG1hcmtzKQogICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgICBpZiBM6ISa5pysWyLoh6rliqjov5vpo58iXSBhbmQgTm93IC0gbGFzdDMgPj0gMTAgdGhlbgogICAgICAgICAgICBsYXN0MyA9IE5vdwogICAgICAgICAgICBsb2NhbCBIUlAgPSBMUC5DaGFyYWN0ZXIgYW5kIExQLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgIGlmIEhSUCB0aGVuCiAgICAgICAgICAgICAgbG9jYWwgZm91bmRGb29kID0gZmFsc2UKICAgICAgICAgICAgICBmb3IgXywgb2JqIGluIHBhaXJzKHdvcmtzcGFjZS5JdGVtczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgb2JqOklzQSgiTW9kZWwiKSBhbmQgKHtbIkNhcnJvdCJdID0gdHJ1ZSwgWyJCZXJyeSJdID0gdHJ1ZSwgWyJNb3JzZWwiXSA9IGZhbHNlLCBbIkNvb2tlZCBNb3JzZWwiXSA9IHRydWUsIFsiU3RlYWsiXSA9IGZhbHNlLCBbIkNvb2tlZCBTdGVhayJdID0gdHJ1ZX0pW29iai5OYW1lXSB0aGVuCiAgICAgICAgICAgICAgICAgIGxvY2FsIG1haW5QYXJ0ID0gb2JqOkZpbmRGaXJzdENoaWxkKCJIYW5kbGUiKSBvciBvYmouUHJpbWFyeVBhcnQKICAgICAgICAgICAgICAgICAgaWYgbWFpblBhcnQgYW5kIChtYWluUGFydC5Qb3NpdGlvbiAtIEhSUC5Qb3NpdGlvbikuTWFnbml0dWRlIDwgMjUgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvdW5kRm9vZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICB0cnlFYXRGb29kKG9iaikKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgIGlmIG5vdCBmb3VuZEZvb2QgdGhlbgogICAgICAgICAgICAgICAgV2luZFVJOk5vdGlmeSh7VGl0bGUgPSAiTOiEmuacrCIsIENvbnRlbnQgPSAi8J+UjTI157Gz6IyD5Zu05YaF5peg6aOf54mpIiwgRHVyYXRpb24gPSA1fSkKICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICBXaW5kVUk6Tm90aWZ5KHtUaXRsZSA9ICJM6ISa5pysIiwgQ29udGVudCA9ICLij7PnrYnlvoXnjqnlrrbliqDovb0iLCBEdXJhdGlvbiA9IDV9KQogICAgICAgICAgICBlbmQKICAgICAgICAgIGVuZAogICAgICBlbmQKICAgICAgdGFzay53YWl0KC4xKQogICAgZW5kKQogICBlbHNlCiAgICBMUDpLaWNrKCLnjq/looPlvILluLjvvIzor7fnqI3lkI7lho3or5UiKQogIGVuZAplbmQpKCkK|base64-d| sh